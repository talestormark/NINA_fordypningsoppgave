\documentclass[border=8pt, multi, tikz]{standalone}
\usepackage{import}
\subimport{layers}{init}
\usetikzlibrary{positioning}
\usetikzlibrary{3d}
\usetikzlibrary{calc}

\def\ConvColor{rgb:yellow,5;red,2.5;white,5}
\def\ConvReluColor{rgb:yellow,5;red,5;white,5}
\def\PoolColor{rgb:red,1;black,0.3}
\def\UnpoolColor{rgb:blue,2;green,1;black,0.3}
\def\ConcatColor{rgb:magenta,5;black,3}
\def\LogitsColor{rgb:magenta,5;black,7}
\def\InputColor{rgb:blue,3;red,2;white,5}

\newcommand{\copymidarrow}{\tikz \draw[-Stealth,line width=0.8mm,draw={rgb:blue,4;red,1;green,1;black,3}] (-0.3,0) -- ++(0.3,0);}

\begin{document}
\begin{tikzpicture}
\tikzstyle{connection}=[ultra thick,every node/.style={sloped,allow upside down},draw=\edgecolor,opacity=0.7]
\tikzstyle{copyconnection}=[ultra thick,every node/.style={sloped,allow upside down},draw={rgb:blue,4;red,1;green,1;black,3},opacity=0.7]

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Input: Early Fusion - Two separate images concatenated
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Image 2018 (actual VHR RGB)
\node[canvas is zy plane at x=0] (img2018) at (-5,0,0)
    {\includegraphics[width=8cm,height=8cm]{input_images/a-0-77133618972711_46-45684360844514_2018.jpg}};
\node[above=0.2cm of img2018, font=\normalsize] {Image 2018 (RGB)};
\node[below=0.2cm of img2018, font=\scriptsize] {H×W×3};

% Image 2024 (actual VHR RGB)
\node[canvas is zy plane at x=0] (img2024) at (-1,0,0)
    {\includegraphics[width=8cm,height=8cm]{MScTemplate/figs/input_images/a-0-77133618972711_46-45684360844514_2024.jpg}};
\node[above=0.2cm of img2024, font=\normalsize] {Image 2024 (RGB)};
\node[below=0.2cm of img2024, font=\scriptsize] {H×W×3};

% Concatenation operation - using standard Box pic
\pic[shift={(0,0,0)}] at (3,0,0) {Box={name=concatbox,caption=Concatenate (Early Fusion),%
        fill=\ConcatColor,opacity=0.6,height=40,width=2,depth=40}};

% Connect inputs to concatenation
\draw [connection]  (img2018) -- (3,0,0);
\draw [connection]  (img2024) -- (3,0,0);

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Encoder (ResNet-50 backbone)
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% conv1 (Conv 7x7, stride 2) + BN + ReLU + MaxPool
\pic[shift={(2,0,0)}] at (concatbox-east) {RightBandedBox={name=cr1,caption=Conv1,%
        xlabel={{"64"}},zlabel=H/2×W/2,fill=\ConvColor,bandfill=\ConvReluColor,%
        height=35,width={2.5},depth=35}};
\pic[shift={(0,0,0)}] at (cr1-east) {Box={name=p1,%
        fill=\PoolColor,opacity=0.5,height=32,width=1,depth=32}};

% Layer1: 3 bottleneck blocks, 256 channels
\pic[shift={(1,0,0)}] at (p1-east) {RightBandedBox={name=cr2,caption=Layer1,%
        xlabel={{"256"}},zlabel=H/4×W/4,fill=\ConvColor,bandfill=\ConvReluColor,%
        height=32,width={3.5},depth=32}};

% Layer2: 4 bottleneck blocks, 512 channels
\pic[shift={(1,0,0)}] at (cr2-east) {RightBandedBox={name=cr3,caption=Layer2,%
        xlabel={{"512"}},zlabel=H/8×W/8,fill=\ConvColor,bandfill=\ConvReluColor,%
        height=25,width={4.5},depth=25}};

% Layer3: 6 bottleneck blocks, 1024 channels
\pic[shift={(0.75,0,0)}] at (cr3-east) {RightBandedBox={name=cr4,caption=Layer3,%
        xlabel={{"1024"}},zlabel=H/16×W/16,fill=\ConvColor,bandfill=\ConvReluColor,%
        height=16,width={6},depth=16}};

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Bottleneck
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Layer4: 3 bottleneck blocks, 2048 channels (deepest point)
\pic[shift={(0.75,0,0)}] at (cr4-east) {RightBandedBox={name=cr5,caption=Bottleneck (Layer4),%
        xlabel={{"2048"}},zlabel=H/32×W/32,fill=\ConvColor,bandfill=\ConvReluColor,%
        height=8,width={8},depth=8}};

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Decoder (U-Net upsampling path with skip connections)
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Upsample 1: H/32 -> H/16
\pic[shift={(1.2,0,0)}] at (cr5-east) {Box={name=up4,%
        fill=\UnpoolColor,opacity=0.6,height=16,width=1,depth=16}};
\pic[shift={(0,0,0)}] at (up4-east) {RightBandedBox={name=ucr4,%
        fill=\ConvColor,bandfill=\ConvReluColor,%
        height=16,width=6,depth=16}};
\pic[shift={(0,0,0)}] at (ucr4-east) {RightBandedBox={name=cat4,%
        fill={rgb:white,1;black,3},bandfill={rgb:white,1;black,2},opacity=0.2,%
        height=16,width=6,depth=16}};
\pic[shift={(0,0,0)}] at (cat4-east) {RightBandedBox={name=ucr4a,%
        zlabel=H/16×W/16,%
        fill=\ConvColor,bandfill=\ConvReluColor,%
        height=16,width=6,depth=16}};

% Upsample 2: H/16 -> H/8
\pic[shift={(1.5,0,0)}] at (ucr4a-east) {Box={name=up3,%
        fill=\UnpoolColor,opacity=0.6,height=25,width=1,depth=25}};
\pic[shift={(0,0,0)}] at (up3-east) {RightBandedBox={name=ucr3,%
        fill=\ConvColor,bandfill=\ConvReluColor,%
        height=25,width=4.5,depth=25}};
\pic[shift={(0,0,0)}] at (ucr3-east) {RightBandedBox={name=cat3,%
        fill={rgb:white,1;black,3},bandfill={rgb:white,1;black,2},opacity=0.2,%
        height=25,width=4.5,depth=25}};
\pic[shift={(0,0,0)}] at (cat3-east) {RightBandedBox={name=ucr3a,%
        zlabel=H/8×W/8,%
        fill=\ConvColor,bandfill=\ConvReluColor,%
        height=25,width=4.5,depth=25}};

% Upsample 3: H/8 -> H/4
\pic[shift={(1,0,0)}] at (ucr3a-east) {Box={name=up2,%
        fill=\UnpoolColor,opacity=0.6,height=32,width=1,depth=32}};
\pic[shift={(0,0,0)}] at (up2-east) {RightBandedBox={name=ucr2,%
        fill=\ConvColor,bandfill=\ConvReluColor,%
        height=32,width=3.5,depth=32}};
\pic[shift={(0,0,0)}] at (ucr2-east) {RightBandedBox={name=cat2,%
        fill={rgb:white,1;black,3},bandfill={rgb:white,1;black,2},opacity=0.2,%
        height=32,width=3.5,depth=32}};
\pic[shift={(0,0,0)}] at (cat2-east) {RightBandedBox={name=ucr2a,%
        zlabel=H/4×W/4,%
        fill=\ConvColor,bandfill=\ConvReluColor,%
        height=32,width=3.5,depth=32}};

% Upsample 4: H/4 -> H/2
\pic[shift={(1.5,0,0)}] at (ucr2a-east) {Box={name=up1,%
        fill=\UnpoolColor,opacity=0.6,height=35,width=1,depth=35}};
\pic[shift={(0,0,0)}] at (up1-east) {RightBandedBox={name=ucr1,%
        fill=\ConvColor,bandfill=\ConvReluColor,%
        height=35,width=2.5,depth=35}};
\pic[shift={(0,0,0)}] at (ucr1-east) {RightBandedBox={name=cat1,%
        fill={rgb:white,1;black,3},bandfill={rgb:white,1;black,2},opacity=0.2,%
        height=35,width=2.5,depth=35}};
\pic[shift={(0,0,0)}] at (cat1-east) {RightBandedBox={name=ucr1a,%
        zlabel=H/2×W/2,%
        fill=\ConvColor,bandfill=\ConvReluColor,%
        height=35,width=2.5,depth=35}};

% Final upsample: H/2 -> H
\pic[shift={(1,0,0)}] at (ucr1a-east) {Box={name=upfinal,%
        fill=\UnpoolColor,opacity=0.6,height=40,width=1,depth=40}};


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Output Head: 1x1 Conv (logits)
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\pic[shift={(0.75,0,0)}] at (upfinal-east) {Box={name=out,caption=Conv 1×1 (logits),%
        zlabel=H×W,fill=\LogitsColor,height=40,width=1.5,depth=40}};

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Forward Connections
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\draw [connection]  (concatbox-east)   -- node {\midarrow} (cr1-west);
\draw [connection]  (p1-east)       -- node {\midarrow} (cr2-west);
\draw [connection]  (cr2-east)      -- node {\midarrow} (cr3-west);
\draw [connection]  (cr3-east)      -- node {\midarrow} (cr4-west);
\draw [connection]  (cr4-east)      -- node {\midarrow} (cr5-west);
\draw [connection]  (cr5-east)      -- node {\midarrow} (up4-west);
\draw [connection]  (ucr4a-east)    -- node {\midarrow} (up3-west);
\draw [connection]  (ucr3a-east)    -- node {\midarrow} (up2-west);
\draw [connection]  (ucr2a-east)    -- node {\midarrow} (up1-west);
\draw [connection]  (ucr1a-east)    -- node {\midarrow} (upfinal-west);
\draw [connection]  (upfinal-east)  -- node {\midarrow} (out-west);

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Skip Connections (copy and concatenate from encoder to decoder)
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\path (cr4-southeast) -- (cr4-northeast) coordinate[pos=1.25] (cr4-top);
\path (cr3-southeast) -- (cr3-northeast) coordinate[pos=1.25] (cr3-top);
\path (cr2-southeast) -- (cr2-northeast) coordinate[pos=1.25] (cr2-top);
\path (cr1-southeast) -- (cr1-northeast) coordinate[pos=1.25] (cr1-top);

\path (cat4-south) -- (cat4-north) coordinate[pos=1.25] (cat4-top);
\path (cat3-south) -- (cat3-north) coordinate[pos=1.25] (cat3-top);
\path (cat2-south) -- (cat2-north) coordinate[pos=1.25] (cat2-top);
\path (cat1-south) -- (cat1-north) coordinate[pos=1.25] (cat1-top);

\draw [copyconnection]  (cr4-northeast)
    -- node {\copymidarrow}(cr4-top)
    -- node {\copymidarrow}(cat4-top)
    -- node {\copymidarrow} (cat4-north);

\draw [copyconnection]  (cr3-northeast)
    -- node {\copymidarrow}(cr3-top)
    -- node {\copymidarrow}(cat3-top)
    -- node {\copymidarrow} (cat3-north);

\draw [copyconnection]  (cr2-northeast)
    -- node {\copymidarrow}(cr2-top)
    -- node {\copymidarrow}(cat2-top)
    -- node {\copymidarrow} (cat2-north);

\draw [copyconnection]  (cr1-northeast)
    -- node {\copymidarrow}(cr1-top)
    -- node {\copymidarrow}(cat1-top)
    -- node {\copymidarrow} (cat1-north);

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\end{tikzpicture}
\end{document}
